<aside>
    <div class="toc" id="toc-container">
        <div class="toc-title-container">
            <div class="toc-title">
                ğŸ—ºï¸ æœ¬é¡µé¢åŒ…å«çš„å†…å®¹ï¼š
            </div>
        </div>
        <div class="toc-container">
            <ul id="toc-list"></ul>
        </div>
    </div>
</aside>

<button class="toc-button" id="toggle-toc">
    <div>ğŸ—ºï¸</div>
    <div style="font-size: 12px;">æ˜¾ç¤ºæœ¬é¡µç›®å½•</div>
</button>

<script>
// åˆ›å»ºTOCçš„JavaScripté€»è¾‘
document.addEventListener('DOMContentLoaded', function() {
    const tocList = document.getElementById('toc-list');
    const tocContainer = document.getElementById('toc-container');
    const toggleButton = document.getElementById('toggle-toc');
    
    // åªé€‰æ‹©å¸¦ç±»çš„ h2, h3, h4
    const headers = document.querySelectorAll('main h2[class], main h3[class], main h4[class]'); 

    // åˆ›å»º TOC æ¡ç›®
    headers.forEach(function(header) {
        const title = header.innerText;
        const id = encodeURIComponent(title)
            .replace(/%20/g, '-')          // æ›¿æ¢ %20 ä¸º -
            .replace(/[^\w-]+/g, '');      // ç§»é™¤æ— æ•ˆå­—ç¬¦

        header.setAttribute('id', id); // è®¾ç½®é”šç‚¹ ID

        const level = header.tagName.toLowerCase(); // è·å–æ ‡é¢˜çº§åˆ«
        const listItem = document.createElement('li');

        listItem.innerHTML = `<a href="#${id}">â¤· ${title}</a>`; // ä½¿ç”¨ â¤· ç¬¦å·ï¼Œä¿æŒ # é”šç‚¹é“¾æ¥

        // æ£€æŸ¥æ ‡é¢˜çš„çº§åˆ«å¹¶åµŒå¥—
        if (level === 'h3') {
            const parent = tocList.querySelector(`li:has(a[href="#${id.split('-')[0]}"])`);
            if (parent) {
                let sublist = parent.querySelector('ul');
                if (!sublist) {
                    sublist = document.createElement('ul');
                    parent.appendChild(sublist);
                }
                sublist.appendChild(listItem);
            } else {
                tocList.appendChild(listItem);
            }
        } else if (level === 'h4') {
            const parent = tocList.querySelector(`li:has(a[href="#${id.split('-')[0]}"])`);
            const grandparent = tocList.querySelector(`ul li:has(ul) a[href="#${id.split('-')[0]}"]`);
            if (parent || grandparent) {
                const sublist = grandparent ? grandparent.parentElement : parent.querySelector('ul');
                if (sublist) {
                    sublist.appendChild(listItem);
                } else {
                    const newSublist = document.createElement('ul');
                    parent.appendChild(newSublist);
                    newSublist.appendChild(listItem);
                }
            } else {
                tocList.appendChild(listItem);
            }
        } else {
            tocList.appendChild(listItem);
        }
    });

    // åˆ‡æ¢ TOC çš„æ˜¾ç¤ºå’Œéšè—
    toggleButton.addEventListener('click', function() {
        if (tocContainer.style.display === "none" || tocContainer.style.display === "") {
            tocContainer.style.display = "block"; // å±•å¼€ TOC
            toggleButton.querySelector('div:last-child').innerText = "éšè— TOC"; // ä¿®æ”¹æŒ‰é’®æ–‡æœ¬
        } else {
            tocContainer.style.display = "none"; // éšè— TOC
            toggleButton.querySelector('div:last-child').innerText = "ç‚¹å‡»æ˜¾ç¤º TOC"; // ä¿®æ”¹æŒ‰é’®æ–‡æœ¬
        }
    });
});
</script>

